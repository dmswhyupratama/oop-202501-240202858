@startuml
autonumber
actor "Kasir" as User
participant "ReturnView" as View
participant "TransactionController" as Ctrl
participant "TransactionService" as Svc
participant "TransactionDAO" as TransDao
participant "ProductDAO" as ProdDao
database "Database" as DB

title Sequence Diagram: Proses Retur Barang

' --- STEP 1: CARI DATA TRANSAKSI ---
User -> View : Input No. Struk / ID Transaksi
activate View
View -> Ctrl : searchTransaction(transId)
activate Ctrl

    Ctrl -> Svc : findTransactionById(transId)
    activate Svc
    
    Svc -> TransDao : findById(transId)
    activate TransDao
    TransDao -> DB : SELECT * FROM transactions WHERE id = ?
    activate DB
    DB --> TransDao : Result Set
    deactivate DB
    TransDao --> Svc : Transaction Data
    deactivate TransDao
    
    Svc --> Ctrl : Transaction Data
    deactivate Svc

    Ctrl -> View : showTransactionDetails(data)
    deactivate Ctrl

' --- STEP 2: PROSES RETUR ---
User -> View : Pilih Item & Klik "Proses Retur"
activate Ctrl
View -> Ctrl : handleReturn(transId, productCode, qty)

    Ctrl -> Svc : processReturn(transId, productCode, qty)
    activate Svc
    
    ' 1. Update Status Transaksi (misal: dicatat di tabel retur)
    Svc -> TransDao : saveReturnLog(transId, productCode, qty)
    activate TransDao
    TransDao -> DB : INSERT INTO returns ...
    activate DB
    DB --> TransDao : Success
    deactivate DB
    deactivate TransDao
    
    ' 2. Kembalikan Stok Barang (Restock)
    Svc -> ProdDao : findByCode(productCode)
    activate ProdDao
    ProdDao --> Svc : Product Data
    deactivate ProdDao
    
    Svc -> ProdDao : updateStock(code, currentStock + qty)
    activate ProdDao
    ProdDao -> DB : UPDATE products SET stock = stock + ?
    activate DB
    DB --> ProdDao : Success
    deactivate DB
    deactivate ProdDao
    
    Svc --> Ctrl : Success
    deactivate Svc

    Ctrl -> View : showMessage("Retur Berhasil")
    Ctrl -> View : clearForm()

deactivate Ctrl
deactivate View
@enduml